{% extends "base.html" %}

{% block title %}Liste √âl√®ves - Mobile{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- En-t√™te -->
    <div class="row mb-3">
        <div class="col-12">
            <h4><i class="bi bi-people-fill me-2"></i>Liste des √âl√®ves</h4>
        </div>
    </div>

    <!-- ‚úÖ NOUVEAU : Filtre de recherche instantan√© -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="input-group input-group-lg">
                <span class="input-group-text bg-primary text-white">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" 
                       id="quick-search" 
                       class="form-control form-control-lg" 
                       placeholder="üîç Tapez nom ou pr√©nom..." 
                       onkeyup="quickFilter()"
                       autocomplete="off"
                       style="font-size: 20px; padding: 15px;">
                <button class="btn btn-outline-secondary" onclick="clearSearch()" type="button">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="mt-2">
                <small class="text-muted">
                    <i class="bi bi-info-circle me-1"></i>
                    R√©sultats : <strong><span id="result-count">{{ students|length }}</span></strong> √©l√®ve(s)
                </small>
            </div>
        </div>
    </div>

    <!-- Liste des √©l√®ves -->
    <div class="list-group">
        {% if students %}
            {% for student in students %}
            <a href="{{ url_for('mobile.edit_student', id=student.id) }}" class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">{{ student.nom }} {{ student.prenom }}</h6>
                        <small class="text-muted">
                            {{ student.ecole }} - Classe {{ student.classe or '?' }}
                        </small>
                    </div>
                    <div>
                        {% if student.status == 'prelisted' %}
                            <span class="badge bg-warning text-dark">Pr√©liste</span>
                        {% elif student.status == 'screened' %}
                            <span class="badge bg-info">D√©pist√©</span>
                        {% elif student.status == 'consulted' %}
                            <span class="badge bg-success">Consult√©</span>
                        {% elif student.status == 'completed' %}
                            <span class="badge bg-secondary">Compl√©t√©</span>
                        {% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        {% else %}
            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>Aucun √©l√®ve trouv√©
            </div>
        {% endif %}
    </div>

    <!-- Bouton retour -->
    <div class="mt-3">
        <a href="/" class="btn btn-secondary w-100">
            <i class="bi bi-arrow-left me-2"></i>Retour Accueil
        </a>
    </div>
</div>

<script>
// Recherche instantan√©e dans la liste mobile
function quickFilter() {
    const input = document.getElementById('quick-search');
    const filter = input.value.toUpperCase();
    const listGroup = document.querySelector('.list-group');
    const items = listGroup.getElementsByClassName('list-group-item');
    let visibleCount = 0;

    for (let i = 0; i < items.length; i++) {
        const item = items[i];
        const h6 = item.querySelector('h6');

        if (h6) {
            const text = h6.textContent || h6.innerText;
            if (text.toUpperCase().indexOf(filter) > -1) {
                item.style.display = '';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        }
    }

    // Mettre √† jour le compteur
    document.getElementById('result-count').textContent = visibleCount;
}

function clearSearch() {
    document.getElementById('quick-search').value = '';
    quickFilter();
}
</script>

{% endblock %}
